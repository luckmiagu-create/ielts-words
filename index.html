<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
<meta name="theme-color" content="#16a34a">
<title>IELTS å•è¯å…¨åŠŸèƒ½åŒæ­¥ç‰ˆ</title>

<script src="https://code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>

<style>
:root{ --main:#16a34a; --bg:#f0fdf4; --card:#fff; --text:#064e3b; --sub:#4b5563; --danger:#dc2626; }
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
body{ margin:0; font-family:-apple-system,system-ui,sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden;}
.app{max-width:420px;margin:auto;padding:16px 16px 100px}

/* å¡ç‰‡ä¸å¸ƒå±€ */
.card{ background:var(--card); border-radius:24px; padding:24px; box-shadow:0 12px 35px rgba(22,163,74,0.12); min-height:260px; position:relative; text-align:center;}
.question{font-size:32px; font-weight:700; word-break:break-all; margin:10px 0 5px; color:var(--text); cursor:pointer;}
.phonetic{color:var(--main); font-family: sans-serif; font-size:18px; margin-bottom:15px; min-height:1.2em; cursor:pointer;}
.hint{color:var(--sub); font-size:14px; margin-bottom:15px;}

input,textarea{ width:100%; padding:15px; font-size:16px; border-radius:15px; border:2px solid #d1fae5; margin-top:12px; outline:none; transition:0.3s;}
input:focus{ border-color:var(--main); background:#fff; box-shadow:0 0 0 4px rgba(22,163,74,0.1); }

.result{margin-top:15px; font-size:20px; font-weight:700; min-height:1.5em}
.correct{color:var(--main)}
.wrong{color:var(--danger)}
.answer{margin-top:5px; color:var(--sub); font-size:16px; min-height:1.5em}

.row{display:flex; gap:10px; justify-content:center; margin-bottom:20px}
button{ padding:12px 18px; border:none; border-radius:14px; background:var(--main); color:#fff; font-size:15px; font-weight:600; cursor:pointer; flex:1; transition:0.2s;}
button:active{ transform:scale(0.96); opacity:0.9; }
.secondary{background:#e2e8f0; color:#475569}
.outline{background:transparent; border:2px solid var(--main); color:var(--main);}

/* ç®¡ç†é¢æ¿ */
.panel{ position:fixed; left:0;right:0;bottom:0; background:#fff; padding:25px; border-radius:28px 28px 0 0; display:none; box-shadow:0 -10px 40px rgba(0,0,0,0.15); z-index:1000; max-height:85vh; overflow-y:auto; }
.word-item { display:flex; justify-content:space-between; align-items:center; padding:15px; border-bottom:1px solid #f1f5f9; text-align: left; }
.word-info b { font-size:18px; color:var(--main); }
.btn-del { background:#fee2e2; color:#ef4444; padding:8px 15px; border-radius:10px; font-size:13px; border:none; width:auto; flex:none;}
</style>
</head>

<body>
<div class="app">
  <div class="row">
    <button onclick="setMode('en2cn')" id="btnEn">è‹±â†’æ±‰</button>
    <button onclick="setMode('cn2en')" id="btnCn" class="secondary">æ±‰â†’è‹±</button>
    <button onclick="togglePool()" id="btnPool" class="secondary">å…¨éƒ¨</button>
  </div>

  <div class="card">
    <div id="syncStatus" style="font-size:10px; color:#cbd5e1; text-align:right;">äº‘ç«¯åŠ è½½ä¸­...</div>
    <div class="question" id="q" onclick="speakCurrent()">åŠ è½½ä¸­...</div>
    <div class="phonetic" id="ph" onclick="speakCurrent()"></div>
    <div class="hint" id="hint">è¯·æ·»åŠ å•è¯</div>
    
    <input id="input" placeholder="è¾“å…¥ç­”æ¡ˆå¹¶å›è½¦" autocomplete="off">
    
    <div class="result" id="result"></div>
    <div class="answer" id="answer"></div>
    
    <div class="row" style="margin-top:25px">
      <button onclick="prev()" class="outline">â†</button>
      <button onclick="speakCurrent()" class="secondary">ğŸ”Š æœ—è¯»</button>
      <button onclick="next()" class="outline">â†’</button>
    </div>
  </div>

  <div style="margin-top: 30px; text-align: center;">
    <button onclick="toggleList()" class="secondary" style="width:auto; padding: 10px 25px;">âš™ï¸ è¯åº“ç®¡ç†ä¸åˆ é™¤</button>
  </div>
</div>

<div style="position:fixed; right:20px; bottom:20px; width:60px; height:60px; border-radius:30px; background:var(--main); color:#fff; font-size:32px; display:flex; align-items:center; justify-content:center; box-shadow:0 10px 25px rgba(0,0,0,0.25); z-index:999; cursor:pointer;" onclick="toggleAdd()">+</div>

<div id="addPanel" class="panel">
  <div style="display:flex; justify-content:space-between; margin-bottom:20px">
    <h3 style="margin:0">æ·»åŠ å•è¯</h3>
    <span onclick="toggleAdd()" style="cursor:pointer; color:#94a3b8; font-size:20px;">âœ•</span>
  </div>
  <input id="newEn" placeholder="è‹±æ–‡å•è¯">
  <input id="newPh" placeholder="éŸ³æ ‡ (é€‰å¡«)">
  <input id="newCn" placeholder="ä¸­æ–‡æ„æ€">
  <button onclick="add()" style="width:100%; margin-top:10px;">ä¿å­˜å•ä¸ª</button>
  <div style="margin-top:20px; border-top:1px dashed #eee; padding-top:20px">
    <h4 style="margin:0 0 10px; font-size:14px; color:var(--sub)">æ‰¹é‡å¯¼å…¥ (è‹±æ–‡:éŸ³æ ‡:ä¸­æ–‡)</h4>
    <textarea id="batchInput" rows="4" placeholder="apple:/ËˆÃ¦pl/:è‹¹æœ&#10;banana:é¦™è•‰"></textarea>
    <button onclick="batchAdd()" style="width:100%; margin-top:10px; background:#059669;">ç¡®è®¤æ‰¹é‡å¯¼å…¥</button>
  </div>
</div>

<div id="listPanel" class="panel">
  <div style="display:flex; justify-content:space-between; margin-bottom:20px">
    <h3 style="margin:0">è¯åº“åˆ—è¡¨ (<span id="wordCount">0</span>)</h3>
    <span onclick="toggleList()" style="cursor:pointer; color:#94a3b8; font-size:20px;">âœ•</span>
  </div>
  <div id="wordListContainer"></div>
</div>

<script>
// --- å…¨å±€é…ç½® ---
let words = JSON.parse(localStorage.getItem("words")) || [];
let index = 0, mode = "en2cn", pool = "all";
const STORAGE_ID = "my_ielts_words_v1"; 

// 2. åˆå§‹åŒ– LeanCloud (å¡«å…¥æ‚¨çš„å‡­è¯)
try {
  AV.init({
    appId: "ezJjMBF0ioTdPd21imL1RQ8y-gzGzoHsz",
    appKey: "7CGxTy5W8FOeVyJRT1BSqaq3",
    serverURL: "https://ezjjmbf0.lc-cn-n1-shared.com" 
  });
  document.getElementById("syncStatus").textContent = "äº‘ç«¯å·²è¿æ¥";
} catch(e) { document.getElementById("syncStatus").textContent = "ç¦»çº¿æ¨¡å¼"; }

// 3. æ ¸å¿ƒæœ—è¯»é€»è¾‘
function speak(text) {
  if (!text) return;
  window.speechSynthesis.cancel();
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = 'en-US';
  msg.rate = 0.85;
  window.speechSynthesis.speak(msg);
}

function speakCurrent() {
  const l = getList();
  if (l.length > 0) speak(l[index].en);
}

// 4. äº‘ç«¯åŒæ­¥é€»è¾‘ (ä¿®å¤æ¶ˆå¤±é—®é¢˜çš„å…³é”®)
async function syncFromCloud() {
  if (typeof AV === 'undefined') { render(); return; }
  const query = new AV.Query('WordData');
  query.equalTo('storageId', STORAGE_ID);
  try {
    const result = await query.first();
    if (result) {
      words = result.get('content');
      localStorage.setItem("words", JSON.stringify(words));
      render();
    }
  } catch(e) { render(); }
}

async function save() {
  // å…ˆå­˜æœ¬åœ°
  localStorage.setItem("words", JSON.stringify(words)); 
  
  if (typeof AV === 'undefined') return;
  
  // å†æ¨é€åˆ°äº‘ç«¯
  const query = new AV.Query('WordData');
  query.equalTo('storageId', STORAGE_ID);
  try {
    let record = await query.first();
    if (!record) {
      const WordObj = AV.Object.extend('WordData');
      record = new WordObj();
      record.set('storageId', STORAGE_ID);
    }
    record.set('content', words);
    await record.save();
    document.getElementById("syncStatus").textContent = "äº‘ç«¯å·²åŒæ­¥";
  } catch(e) { document.getElementById("syncStatus").textContent = "åŒæ­¥å¤±è´¥"; }
}

// 5. ä¸šåŠ¡é€»è¾‘
function getList() { return pool === "wrong" ? words.filter(w => w.wrong) : words; }

function render() {
  const l = getList();
  if(!l.length) { 
    document.getElementById("q").textContent = "è¯åº“ä¸ºç©º"; 
    document.getElementById("ph").textContent = "";
    document.getElementById("hint").textContent = "ç‚¹å‡» + æ·»åŠ å•è¯";
    return; 
  }
  if (index >= l.length) index = 0;
  if (index < 0) index = l.length - 1;

  const current = l[index];
  if(mode === "en2cn") {
    document.getElementById("q").textContent = current.en;
    document.getElementById("ph").textContent = current.ph ? `[${current.ph}]` : "";
    document.getElementById("hint").textContent = `å•è¯ ${index+1}/${l.length} | è¾“å…¥ä¸­æ–‡`;
    speak(current.en);
  } else {
    document.getElementById("q").textContent = current.cn;
    document.getElementById("ph").textContent = "";
    document.getElementById("hint").textContent = `å•è¯ ${index+1}/${l.length} | è¾“å…¥æ‹¼å†™`;
  }
  document.getElementById("input").value = ""; 
  document.getElementById("result").textContent = ""; 
  document.getElementById("answer").textContent = "";
}

function next() { index++; render(); }
function prev() { index--; render(); }

document.getElementById("input").onkeydown = e => {
  if(e.key === "Enter") {
    const val = e.target.value.trim().toLowerCase();
    const l = getList();
    const current = l[index];
    let isCorrect = mode === "en2cn" ? current.cn.includes(val) : val === current.en.toLowerCase();
    
    if(isCorrect && val !== "") {
      document.getElementById("result").textContent = "âœ… æ­£ç¡®";
      document.getElementById("result").className = "result correct";
      current.wrong = 0; save();
      setTimeout(next, 800);
    } else {
      document.getElementById("result").textContent = "âŒ é”™è¯¯";
      document.getElementById("result").className = "result wrong";
      current.wrong = 1; save();
      document.getElementById("answer").textContent = "ç­”æ¡ˆï¼š" + (mode === "en2cn" ? current.cn : current.en);
      speak(current.en);
    }
  }
};

// 6. é¢æ¿æ§åˆ¶
function toggleAdd() { addPanel.style.display = addPanel.style.display === "block" ? "none" : "block"; }
function toggleList() { 
  if(listPanel.style.display === "block") { listPanel.style.display = "none"; }
  else { listPanel.style.display = "block"; refreshWordList(); }
}

function add() {
  const en = newEn.value.trim(), ph = newPh.value.trim(), cn = newCn.value.trim();
  if(!en || !cn) return;
  words.push({en: en.toLowerCase(), ph: ph, cn: cn, wrong: 0});
  save(); render();
  newEn.value = ""; newPh.value = ""; newCn.value = "";
}

function batchAdd() {
  const text = batchInput.value.trim();
  if(!text) return;
  text.split('\n').forEach(line => {
    const p = line.split(/[:ï¼š]/);
    if(p.length === 2) words.push({en: p[0].trim().toLowerCase(), ph: "", cn: p[1].trim(), wrong: 0});
    else if(p.length >= 3) words.push({en: p[0].trim().toLowerCase(), ph: p[1].trim(), cn: p[2].trim(), wrong: 0});
  });
  save(); toggleAdd(); render();
  batchInput.value = "";
}

function refreshWordList() {
  wordListContainer.innerHTML = "";
  wordCount.textContent = words.length;
  words.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "word-item";
    div.innerHTML = `<div class="word-info"><b>${item.en}</b><br><small>${item.cn}</small></div>
                     <button class="btn-del" onclick="removeWord(${i})">åˆ é™¤</button>`;
    wordListContainer.appendChild(div);
  });
}

function removeWord(i) {
  if(confirm(`åˆ é™¤ "${words[i].en}"ï¼Ÿ`)) { words.splice(i, 1); save(); refreshWordList(); render(); }
}

function setMode(m) { mode = m; btnEn.className = m==='en2cn'?'':'secondary'; btnCn.className = m==='cn2en'?'':'secondary'; render(); }
function togglePool() { 
  pool = (pool === "all" ? "wrong" : "all"); 
  btnPool.textContent = pool === "all" ? "å…¨éƒ¨" : "é”™é¢˜";
  btnPool.className = pool === "all" ? "secondary" : "";
  index = 0; render(); 
}

// é¡µé¢åŠ è½½æ—¶æ‰§è¡ŒåŒæ­¥
window.onload = syncFromCloud;
</script>
</body>
</html>