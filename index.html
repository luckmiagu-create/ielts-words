<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="theme-color" content="#16a34a">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --main:#16a34a;
  --bg:#f0fdf4;
  --card:#fff;
  --text:#064e3b;
  --sub:#4b5563;
  --danger:#dc2626;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei";
  background:var(--bg);
  color:var(--text);
}
.app{max-width:420px;margin:auto;padding:16px 16px 90px}
.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
.question{text-align:center;font-size:26px;font-weight:700}
.hint{text-align:center;color:var(--sub);margin-top:6px}
input,textarea{
  width:100%;
  padding:14px;
  font-size:18px;
  border-radius:14px;
  border:2px solid #d1fae5;
  margin-top:12px;
}
.result{text-align:center;margin-top:10px;font-size:18px;font-weight:600}
.correct{color:var(--main)}
.wrong{color:var(--danger)}
.answer{text-align:center;margin-top:6px}
.row{display:flex;gap:10px;justify-content:center;margin-top:12px}
button{
  padding:10px 14px;
  border:none;
  border-radius:14px;
  background:var(--main);
  color:#fff;
  font-size:15px;
}
.secondary{background:#6b7280}

/* 悬浮按钮（核心） */
.fab{
  position:fixed;
  right:18px;
  bottom:18px;
  width:60px;
  height:60px;
  border-radius:50%;
  background:var(--main);
  color:#fff;
  font-size:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
  z-index:9999;
}
#addPanel{
  position:fixed;
  left:0;right:0;bottom:0;
  background:#fff;
  padding:18px;
  border-radius:18px 18px 0 0;
  display:none;
}
</style>
</head>

<body>
<div class="app">

<div class="row">
  <button onclick="mode='en2cn';render()">英→汉</button>
  <button onclick="mode='cn2en';render()" class="secondary">汉→英</button>
  <button onclick="pool='wrong';render()" class="secondary">错题</button>
</div>

<div class="card">
  <div class="question" id="q">请添加单词</div>
  <div class="hint" id="hint"></div>
  <input id="input" placeholder="输入答案，回车确认">
  <div class="result" id="result"></div>
  <div class="answer" id="answer"></div>
</div>

</div>

<!-- 悬浮添加按钮（永远可见） -->
<div class="fab" onclick="toggleAdd()">+</div>

<div id="addPanel">
  <input id="newEn" placeholder="英文">
  <input id="newCn" placeholder="中文">
  <button onclick="add()">保存</button>
</div>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

let words=JSON.parse(localStorage.getItem("words"))||[];
let index=0, mode="en2cn", pool="all";
let current=null;

function save(){localStorage.setItem("words",JSON.stringify(words))}

function list(){
  return pool==="wrong"?words.filter(w=>w.wrong):words;
}

function render(){
  const l=list();
  if(!l.length){q.textContent="暂无单词";return;}
  current=l[index%l.length];
  q.textContent=mode==="en2cn"?current.en:current.cn;
  hint.textContent=mode==="en2cn"?"请输入中文":"请输入英文";
  input.value="";result.textContent="";answer.textContent="";
}

input.onkeydown=e=>{
  if(e.key==="Enter"){
    const v=input.value.trim();
    let ok=mode==="en2cn"?current.cn.includes(v):v===current.en;
    if(ok){
      result.textContent="✅ 正确";
      result.className="result correct";
      current.wrong=0;
      save();
      setTimeout(()=>{index++;render()},500);
    }else{
      result.textContent="❌ 错误";
      result.className="result wrong";
      current.wrong=1;
      answer.textContent="正确答案："+(mode==="en2cn"?current.cn:current.en);
      save();
    }
  }
};

function toggleAdd(){
  addPanel.style.display=addPanel.style.display==="block"?"none":"block";
}
function add(){
  if(!newEn.value||!newCn.value)return;
  words.push({en:newEn.value.toLowerCase(),cn:newCn.value,wrong:0});
  save();toggleAdd();render();
}
render();
</script>
</body>
</html>
