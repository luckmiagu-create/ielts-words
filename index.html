<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>é›…æ€å•è¯è®°å¿† Â· ç¨³å®šæœ€ç»ˆç‰ˆ</title>

<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="theme-color" content="#4f46e5">

<style>
:root{
  --bg:#f5f7fa;--card:#ffffff;--text:#111827;
  --sub:#6b7280;--btn:#4f46e5;--ok:#16a34a;--bad:#dc2626;
}
.dark{
  --bg:#0f172a;--card:#1e293b;--text:#f8fafc;
  --sub:#94a3b8;--btn:#6366f1;
}
*{box-sizing:border-box}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",Arial;
}
.app{max-width:860px;margin:auto;padding:16px}
h1{text-align:center;margin:12px 0}

.card{
  background:var(--card);
  padding:22px;
  border-radius:20px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}
.row{
  display:flex;gap:10px;justify-content:center;
  flex-wrap:wrap;margin:10px 0;
}
button{
  min-width:96px;padding:10px 16px;
  border:none;border-radius:14px;
  font-size:15px;cursor:pointer;
  background:var(--btn);color:#fff;
}
.secondary{background:#64748b}
.danger{background:#dc2626}

.question{
  font-size:28px;font-weight:700;
  text-align:center;margin-bottom:6px;
}
.hint{
  text-align:center;color:var(--sub);
  font-size:15px;margin-bottom:8px;
}
input,textarea{
  width:92%;display:block;margin:10px auto;
  padding:14px;font-size:18px;
  border-radius:14px;
  border:2px solid #e5e7eb;
  outline:none;
}
input:focus,textarea:focus{border-color:var(--btn)}

.feedback{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  margin-top:8px;
}
.ok{color:var(--ok)}
.bad{color:var(--bad)}

.answer{text-align:center;margin-top:6px;display:none}
.stats{text-align:center;color:var(--sub);font-size:14px;margin-top:12px}
textarea{height:120px}
</style>
</head>

<body>
<div class="app">

<h1>é›…æ€å•è¯è®°å¿† Â· ç¨³å®šæœ€ç»ˆç‰ˆ</h1>

<div class="row">
  <button onclick="setMode('en2cn')">è‹±â†’æ±‰</button>
  <button onclick="setMode('cn2en')" class="secondary">æ±‰â†’è‹±</button>
  <button onclick="toggleDark()" class="secondary">ğŸŒ™</button>
</div>

<div class="card">
  <div class="question" id="q"></div>
  <div class="hint" id="hint"></div>
  <input id="input" placeholder="è¾“å…¥ç­”æ¡ˆï¼Œå›è½¦æäº¤" enterkeyhint="done">
  <div class="feedback" id="feedback"></div>
  <div class="answer" id="answer"></div>
</div>

<div class="row">
  <button onclick="submitAnswer()">âœ” æäº¤</button>
  <button onclick="markForgot()" class="secondary">âœ– å¿˜è®°</button>
  <button onclick="showAnswer()">ğŸ‘€ ç­”æ¡ˆ</button>
</div>

<div class="row">
  <button onclick="toggleAdd()" class="secondary">â• æ·»åŠ å•è¯</button>
  <button onclick="exportData()" class="secondary">ğŸ“¤ å¯¼å‡º</button>
  <button onclick="importData()" class="secondary">ğŸ“¥ å¯¼å…¥</button>
</div>

<div class="stats" id="stats"></div>

<div id="addPanel" class="card" style="display:none;margin-top:14px">
  <h3 style="text-align:center">â• æ·»åŠ å•è¯</h3>
  <input id="newEn" placeholder="è‹±æ–‡">
  <input id="newCn" placeholder="ä¸­æ–‡">
  <button onclick="addWord()">ä¿å­˜</button>
</div>

</div>

<script>
/* ===== åŸºç¡€æ•°æ® ===== */
const DAY = 86400000;
let mode="en2cn";
let current=null;
let dark = localStorage.getItem("dark")==="1";

let words = JSON.parse(localStorage.getItem("words")) || [
  make("abandon","æ”¾å¼ƒ"),
  make("accurate","å‡†ç¡®çš„"),
  make("analyze","åˆ†æ")
];

function make(en,cn){
  return {en,cn,ease:2.5,interval:0,due:0};
}

/* ===== SRS ===== */
function schedule(w,ok){
  if(ok){
    w.ease=Math.max(1.3,w.ease+0.1);
    w.interval=w.interval?Math.round(w.interval*w.ease):1;
  }else{
    w.ease=Math.max(1.3,w.ease-0.2);
    w.interval=1;
  }
  w.due=Date.now()+w.interval*DAY;
}

/* ===== UI ===== */
function setMode(m){mode=m;next()}
function toggleDark(){
  dark=!dark;
  document.body.classList.toggle("dark",dark);
  localStorage.setItem("dark",dark?"1":"0");
}
function showAnswer(){
  answer.style.display="block";
}

/* ===== ä¸»æµç¨‹ ===== */
function next(){
  if(!words.length){
    q.textContent="è¯·å…ˆæ·»åŠ å•è¯";
    return;
  }
  current=words[Math.floor(Math.random()*words.length)];
  render();
}

function render(){
  q.textContent=(mode==="cn2en"?"æ±‰è¯‘è‹±ï¼š":"è‹±è¯‘æ±‰ï¼š")+
    (mode==="cn2en"?current.cn:current.en);
  hint.textContent=mode==="cn2en"
    ?current.en.slice(0,2)+" _ ".repeat(current.en.length-2)
    :current.cn[0]+"â–¡".repeat(current.cn.length-1);
  answer.textContent="æ­£ç¡®ç­”æ¡ˆï¼š"+(mode==="cn2en"?current.en:current.cn);
  answer.style.display="none";
  feedback.textContent="";
  input.value="";
  stats.textContent=`è¯åº“æ•°é‡ï¼š${words.length}`;
}

/* ===== åˆ¤é¢˜ï¼ˆå·²ä¿®å¥½ï¼‰ ===== */
function submitAnswer(){
  const v=input.value.trim();
  let ok=false;
  if(mode==="cn2en"){
    ok=v.toLowerCase()===current.en;
  }else{
    ok=current.cn.includes(v);
  }

  schedule(current,ok);
  feedback.textContent = ok ? "âœ… æ­£ç¡®" : "âŒ é”™è¯¯";
  feedback.className = "feedback "+(ok?"ok":"bad");

  save();
  setTimeout(next,800);
}

function markForgot(){
  schedule(current,false);
  feedback.textContent="âŒ å·²æ ‡è®°ä¸ºå¿˜è®°";
  feedback.className="feedback bad";
  save();
  setTimeout(next,800);
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    submitAnswer();
  }
});

/* ===== æ·»åŠ  ===== */
function toggleAdd(){
  addPanel.style.display=addPanel.style.display==="none"?"block":"none";
}
function addWord(){
  const en=newEn.value.trim().toLowerCase();
  const cn=newCn.value.trim();
  if(!en||!cn) return alert("è¯·è¾“å…¥å®Œæ•´");
  if(words.find(w=>w.en===en)) return alert("å·²å­˜åœ¨");
  words.push(make(en,cn));
  save();
  toggleAdd();
  next();
}

/* ===== å¯¼å…¥å¯¼å‡ºï¼ˆæœ€ç¨³åŒæ­¥æ–¹æ¡ˆï¼‰ ===== */
function exportData(){
  const blob=new Blob([JSON.stringify(words,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ielts_words.json";
  a.click();
}
function importData(){
  const i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    const f=e.target.files[0];
    const r=new FileReader();
    r.onload=()=>{
      try{
        words=JSON.parse(r.result);
        save(); next();
        alert("å¯¼å…¥æˆåŠŸ");
      }catch{
        alert("æ–‡ä»¶æ ¼å¼é”™è¯¯");
      }
    };
    r.readAsText(f);
  };
  i.click();
}

/* ===== å­˜å‚¨ ===== */
function save(){
  localStorage.setItem("words",JSON.stringify(words));
}

/* ===== å¯åŠ¨ ===== */
document.body.classList.toggle("dark",dark);
next();
</script>
</body>
</html>
