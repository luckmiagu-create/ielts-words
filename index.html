<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>é›…æ€å•è¯è®°å¿† Â· ç¨³å®šå®Œæ•´ç‰ˆ</title>
<style>
body{font-family:Arial,"PingFang SC","Microsoft YaHei",sans-serif;background:#f5f7fa;padding:20px}
.app{max-width:860px;margin:auto;background:#fff;padding:22px;border-radius:16px;box-shadow:0 8px 18px rgba(0,0,0,.14)}
h1{text-align:center}
.row{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:12px}
button{padding:8px 14px;border:none;border-radius:8px;cursor:pointer;background:#4f46e5;color:#fff}
button.secondary{background:#64748b}
button.success{background:#16a34a}
button:disabled{background:#9ca3af}
.card{text-align:center;margin-top:20px}
.question{font-size:26px;font-weight:bold}
.hint{margin-top:10px;color:#6b7280;font-size:18px}
input{margin-top:15px;padding:10px;width:80%;font-size:18px}
.result{margin-top:10px;font-weight:bold}
.answer{display:none;margin-top:10px;color:#374151}
.stats{text-align:center;margin-top:12px;font-size:14px;color:#374151}
.progress{height:8px;background:#e5e7eb;border-radius:6px;overflow:hidden;margin-top:8px}
.progress-bar{height:100%;width:0;background:#4f46e5}
</style>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4f46e5">

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });
}
</script>

</head>

<body>
<div class="app">
<h1>é›…æ€å•è¯è®°å¿† Â· ç¨³å®šå®Œæ•´ç‰ˆ</h1>

<div class="row">
<button onclick="setMode('en2cn')">è‹±â†’æ±‰</button>
<button onclick="setMode('cn2en')" class="secondary">æ±‰â†’è‹±</button>
</div>

<div class="card">
<div class="question" id="question">è¯·å…ˆæ·»åŠ å•è¯</div>
<div class="hint" id="hint"></div>
<input id="input" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" />
<div class="result" id="result"></div>
<div class="answer" id="answer"></div>
</div>

<div class="stats" id="stats"></div>
<div class="progress"><div class="progress-bar" id="progress"></div></div>

<div class="row" style="margin-top:16px">
  <div class="row" style="margin-top:10px">
  <button onclick="exportWords()" class="secondary">ğŸ“¤ å¯¼å‡ºè¯åº“</button>
  <button onclick="document.getElementById('importFile').click()" class="secondary">
    ğŸ“¥ å¯¼å…¥è¯åº“
  </button>
  <input type="file" id="importFile" accept=".txt,.json" style="display:none" />
</div>
<button onclick="checkAnswer()" class="success">ç¡®è®¤</button>
<button onclick="showAnswer()" class="secondary">æŸ¥çœ‹ç­”æ¡ˆ</button>
<button onclick="nextWord()">ä¸‹ä¸€ä¸ª</button>
<button onclick="speak()" class="secondary">ğŸ”Š å‘éŸ³</button>
<button onclick="toggleAdd()" class="secondary">â• æ·»åŠ å•è¯</button>
</div>

<div id="addPanel" style="display:none;margin-top:16px;text-align:center;">
<input id="newEn" placeholder="è‹±æ–‡å•è¯" style="width:35%;margin:5px" />
<input id="newCn" placeholder="ä¸­æ–‡é‡Šä¹‰" style="width:35%;margin:5px" />
<br/>
<button onclick="addWord()" class="success">ä¿å­˜å•è¯</button>
</div>
</div>

<script>
let defaultWords = [
  { en:"abandon", cn:"æ”¾å¼ƒ", level:0 },
  { en:"accurate", cn:"å‡†ç¡®çš„", level:0 },
  { en:"analyze", cn:"åˆ†æ", level:0 }
];

let allWords = [];
let current = null;
let mode = 'en2cn';
let total = 0, correct = 0;

// ===== åˆå§‹åŒ–è¯åº“ï¼ˆå…³é”®ä¿®å¤ç‚¹ï¼‰=====
const saved = localStorage.getItem('userWords');
if(saved){
  try{
    const parsed = JSON.parse(saved);
    allWords = parsed.length ? parsed : defaultWords;
  }catch{
    allWords = defaultWords;
  }
}else{
  allWords = defaultWords;
}

// ===== å·¥å…·å‡½æ•° =====
function setMode(m){ mode=m; nextWord(); }

function getHint(){
 if(!current) return '';
 if(mode==='cn2en'){
  return current.en.slice(0,2)+' '+'_ '.repeat(current.en.length-2);
 }
 return current.cn[0]+'â–¡'.repeat(current.cn.length-1);
}

function render(){
 if(!current){
  document.getElementById('question').textContent='è¯·å…ˆæ·»åŠ å•è¯';
  return;
 }
 const bars=['â¬œâ¬œâ¬œ','ğŸŸ¨â¬œâ¬œ','ğŸŸ©ğŸŸ¨â¬œ','ğŸŸ©ğŸŸ©ğŸŸ©'];
 document.getElementById('question').textContent =
   (mode==='cn2en'?'æ±‰è¯‘è‹±ï¼š':'è‹±è¯‘æ±‰ï¼š')+(mode==='cn2en'?current.cn:current.en);
 document.getElementById('hint').textContent='ç†Ÿç»ƒåº¦ï¼š'+bars[current.level]+' ï½œ æç¤ºï¼š'+getHint();
 document.getElementById('answer').textContent='æ­£ç¡®ç­”æ¡ˆï¼š'+(mode==='cn2en'?current.en:current.cn);
 document.getElementById('answer').style.display='none';
 document.getElementById('input').value='';
 document.getElementById('result').textContent='';
 updateStats();
}

function nextWord(){
 if(!allWords.length){ current=null; render(); return; }
 current = allWords[Math.floor(Math.random()*allWords.length)];
 render();
}

function normalizeCn(t){ return t.replace(/\s|ï¼›|ï¼Œ/g,''); }

function checkAnswer(){
 if(!current) return;
 const v=document.getElementById('input').value.trim();
 let ok = mode==='cn2en'
   ? v.toLowerCase()===current.en
   : normalizeCn(current.cn).includes(normalizeCn(v));
 total++;
 if(ok){
  correct++;
  current.level=Math.min(current.level+1,3);
  document.getElementById('result').textContent='âœ… æ­£ç¡®';
 }else{
  current.level=Math.max(current.level-1,0);
  document.getElementById('result').textContent='âŒ é”™è¯¯';
 }
 localStorage.setItem('userWords',JSON.stringify(allWords));
 updateStats();
}

function showAnswer(){
 if(current) document.getElementById('answer').style.display='block';
}

function updateStats(){
 document.getElementById('stats').textContent =
  `æ­£ç¡®ç‡ï¼š${total?Math.round(correct/total*100):0}%ï¼ˆ${correct}/${total}ï¼‰`;
 document.getElementById('progress').style.width =
  total?Math.round(correct/total*100)+'%':'0%';
}

function speak(){
 if(!current) return;
 const u=new SpeechSynthesisUtterance(current.en);
 u.lang='en-US'; speechSynthesis.speak(u);
}

// ===== æ·»åŠ å•è¯ =====
function toggleAdd(){
 const p=document.getElementById('addPanel');
 p.style.display=p.style.display==='none'?'block':'none';
}

function addWord(){
 const en=document.getElementById('newEn').value.trim().toLowerCase();
 const cn=document.getElementById('newCn').value.trim();
 if(!en||!cn){alert('è¯·è¾“å…¥å®Œæ•´');return;}
 if(allWords.find(w=>w.en===en)){alert('å·²å­˜åœ¨');return;}
 allWords.push({en,cn,level:0});
 localStorage.setItem('userWords',JSON.stringify(allWords));
 document.getElementById('newEn').value='';
 document.getElementById('newCn').value='';
 nextWord();
 alert('æ·»åŠ æˆåŠŸ');
}

// å¯åŠ¨
nextWord();
</script>
</body>
</html>
// ===== å¯¼å‡ºè¯åº“ =====
function exportWords(){
  const data = JSON.stringify(allWords, null, 2);
  const blob = new Blob([data], {type: "application/json"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "ielts_words.json";
  a.click();

  URL.revokeObjectURL(url);
}

// ===== å¯¼å…¥è¯åº“ =====
document.getElementById("importFile").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(){
    try{
      let imported = [];

      if(file.name.endsWith(".json")){
        imported = JSON.parse(reader.result);
      }else{
        // TXT
        const lines = reader.result.split(/\r?\n/);
        for(const line of lines){
          if(!line.includes("=")) continue;
          const [en, cn] = line.split("=");
          if(en && cn){
            imported.push({
              en: en.trim().toLowerCase(),
              cn: cn.trim(),
              level: 0
            });
          }
        }
      }

      // åˆå¹¶å»é‡
      let added = 0;
      imported.forEach(w=>{
        if(!allWords.find(x=>x.en===w.en)){
          allWords.push(w);
          added++;
        }
      });

      localStorage.setItem("userWords", JSON.stringify(allWords));
      alert(`å¯¼å…¥å®Œæˆï¼Œæ–°å¢ ${added} ä¸ªå•è¯`);
      nextWord();

    }catch(err){
      alert("æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œå¯¼å…¥å¤±è´¥");
    }
  };

  reader.readAsText(file, "utf-8");
});
